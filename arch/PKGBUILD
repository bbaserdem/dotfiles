# Maintainer: Batuhan Baserdem <baserdem.batuhan@gmail.com>
pkgbase=bbaserdem
pkgname=(
    bbaserdem-base
    bbaserdem-efi
    bbaserdem-bios
    bbaserdem-desktop
    bbaserdem-devel
    bbaserdem-gaming
    bbaserdem-server
    bbaserdem-asus-gl702zc
    bbaserdem-asus-n550jk
    bbaserdem-dell-t7500
)
pkgver=1
pkgrel=1
pkgdesc="Generic build for bbaserdem computer systems"
arch=(any)
url="https://github.com/bbaserdem/dotfiles"
licence=(MIT)
groups=(bbaserdem)
source=()

package_bbaserdem-base() {
    provides=(nano vim vi)
    conflicts=(nano vim vi)
    install=bbaserdem-base.install

    # Base and base-devel group
    # Removed; netctl, nano, vi, reiserfsprogs
    depends=(
        'bash'          'bzip2'         'coreutils'     'cryptsetup'
        'device-mapper' 'dhcpcd'        'diffutils'     'e2fsprogs'
        'file'          'filesystem'    'findutils'     'gawk'
        'gcc-libs'      'gettext'       'glibc'         'grep'
        'gzip'          'inetutils'     'iproute2'      'iputils'
        'jfsutils'      'less'          'licenses'      'linux'
        'logrotate'     'lvm2'          'man-db'        'man-pages'
        'mdadm'         'pacman'        'pciutils'
        'pcmciautils'   'perl'          'procps-ng'     'psmisc'
        's-nail'        'sed'           'shadow'
        'sysfsutils'    'systemd-sysvcompat'    'tar'   'texinfo'
        'usbutils'      'util-linux'    'which'         'xfsprogs'
        'autoconf'      'automake'      'binutils'      'bison'
        'fakeroot'      'file'          'findutils'     'flex'
        'gawk'          'gcc'           'gettext'       'grep'
        'groff'         'gzip'          'libtool'       'm4'
        'make'          'pacman'        'patch'         'pkgconf'
        'sed'           'sudo'          'systemd'       'texinfo'
        'util-linux'    'which'
        )
    install -Dm 0644 bbaserdem-base.vconsole "${pkgdir}/etc/vconsole.conf"
    install -Dm 0640 bbaserdem-base.sudoers "${pkgdir}/etc/sudoers.d/bbaserdem-base"
    install -Dm 0644 bbaserdem-base.sysctl "${pkgdir}/etc/sysctl.d/01-sysctl.conf"
    install -Dm 0644 bbaserdem-base.inotify "${pkgdir}/etc/sysctl.d/01-inotify.conf"
    install -Dm 0644 bbaserdem-base.fixed-bitmap "${pkgdir}/etc/fonts/conf.avail/90-fixed-bitmaps.conf"
    install -Dm 0644 bbaserdem-base.wired "${pkgdir}/etc/systemd/network/20-wired.network"
    install -Dm 0644 bbaserdem-base.wireless "${pkgdir}/etc/systemd/network/20-wireless.network"

    # Filesystems
    depends+=( 'btrfs-progs' 'f2fs-tools' )

    # Extra packages
    depends+=(
        'abcde'                         # CD ripper
        'asp'                           # Arch Source Package management
        'atool'                         # Archive tool for following formats
        'bzip2' 'cpio' 'gzip' 'lhasa' 'lzop' 'p7zip' 'tar' 'unace' 'unrar' 'unzip' 'xz' 'zip'
        'bash-completion'               # Programmable completion for bash
        'discount'                      # Markdown implementation
        'flatpak'                       # Jailed software repository
        'geoip' 'geoip-database-extra'  # IP to location resolver
        'git'                           # Version control tool
        'gnupg'                         # GPG verifications
        'imagemagick'                   # Commandline image manipulator
        'jq' 'yajl'                     # JSON processor
        'languagetool'                  # Grammar checker
        'linux-firmware'                # Firmware for the Linux kernel
        'linux-headers'                 # Kernel headers
        'msmtp' 'msmtp-mta'             # SMTP client for mailing
        'offlineimap' 'notmuch'         # IMAP mail fetcher (and organizer)
        'nftables'                      # Firewall
        'pacman-contrib'                # Tools for pacman
        'powerline-fonts'               # Fonts for powerline symbols (console)
        'pass' 'qrencode'               # Password manager
        'reflector'                     # Pacman mirror sorting
        'rsync'                         # File synching utility
        'snapper'                       # BTRFS snapshot manager
        'sshfs' 'openssh' 'fuse3'       # SSH and FUSE for ssh
        'stow'                          # Symlink manager
        'sudo'                          # To check your privilage
        'tor'                           # TOR Onion network
        'tmux'                          # Terminal multiplexer
        'openconnect' 'openvpn'         # VPN services
        'wine'                          # Windows compatibility
        'wpa_supplicant'                # Wireless connection supplicant
        'zsh'                           # Interactive shell
        'alsa-utils' 'lib32-alsa-plugins'                       # ALSA
        'pulseaudio' 'lib32-libpulse' 'pamixer' 'pavucontrol'   # Pulseaudio
        'pulseaudio-alsa'                                       # Pulse plugins
        'mpc' 'mpd'                                             # Music daemon
        )

    # Console apps
    depends+=(
        'calcurse'                                  # Calender
        'htop'                                      # Process viewer
        'ncmpcpp'                                   # Music player
        'neofetch'                                  # System info printer
        'neomutt'                                   # Mail reader
        'neovim' 'python-neovim' 'python2-neovim'   # Text editor
        'parted'                                    # Partition manager
        'ranger'                                    # File browser
        'task'                                      # Taskwarrior tasks manager
        'w3m'                                       # Console based web browser
    )
    chmod 750 /.snapshots
    install -Dm 0644 bbaserdem-base.snapper-root "${pkgdir}/etc/snapper/configs/root"
    install -dm 0755 "${pkgdir}/usr/bin"
    ln -s /usr/bin/nvim "${pkgdir}/usr/bin/vim"
    ln -s /usr/bin/nvim "${pkgdir}/usr/bin/vi"

}

package_bbaserdem-efi() {
    install=bbaserdem-efi.install
    depends=('efitools' 'refind-efi' 'sbsigntools')
    install -Dm 0755 bbaserdem-efi.sign "${pkgdir}/etc/sbkeys/sbsign.sh"
    install -Dm 0644 bbaserdem-efi.refind "${pkgdir}/boot/EFI/refind/refind.conf"
    install -Dm 0644 bbaserdem-efi.hook "${pkgdir}/etc/pacman.d/hooks/10-refind.hook"
    install -Dm 0644 bbaserdem-efi.stable "${pkgdir}/etc/pacman.d/hooks/11-stable.hook"
    install -Dm 0644 bbaserdem-efi.longterm "${pkgdir}/etc/pacman.d/hooks/12-longterm.hook"
    install -Dm 0644 bbaserdem-efi.hardened "${pkgdir}/etc/pacman.d/hooks/12-hardened.hook"
    install -Dm 0644 bbaserdem-efi.zen "${pkgdir}/etc/pacman.d/hooks/13-zen.hook"
}

package_bbaserdem-bios() {
    depends=('grub' 'os-prober')
}

package_bbaserdem-desktop() {
    depends=(bbaserdem-base)

    # X-org and wayland studd
    depends+=(
        'xorgproto'             'xf86-video-vesa'       'xorg-bdftopcf'
        'xorg-docs'             'xorg-font-util'        'xorg-fonts-100dpi'
        'xorg-fonts-75dpi'      'xorg-fonts-encodings'  'xorg-iceauth'
        'xorg-luit'             'xorg-mkfontdir'        'xorg-mkfontscale'
        'xorg-server'           'xorg-server-common'    'xorg-server-devel'
        'xorg-server-xdmx'      'xorg-server-xephyr'    'xorg-server-xnest'
        'xorg-server-xvfb'      'xorg-server-xwayland'  'xorg-sessreg'
        'xorg-setxkbmap'        'xorg-smproxy'          'xorg-x11perf'
        'xorg-xauth'            'xorg-xbacklight'       'xorg-xcmsdb'
        'xorg-xcursorgen'       'xorg-xdpyinfo'         'xorg-xdriinfo'
        'xorg-xev'              'xorg-xgamma'           'xorg-xhost'
        'xorg-xinput'           'xorg-xkbcomp'          'xorg-xkbevd'
        'xorg-xkbutils'         'xorg-xkill'            'xorg-xlsatoms'
        'xorg-xlsclients'       'xorg-xmodmap'          'xorg-xpr'
        'xorg-xprop'            'xorg-xrandr'           'xorg-xrdb'
        'xorg-xrefresh'         'xorg-xset'             'xorg-xsetroot'
        'xorg-xvinfo'           'xorg-xwd'              'xorg-xwininfo'
        'xorg-xwud'
        'wayland'
        )

    # Window-manager and related
    depends+=(
        'bspwm'             # Tiling window manager
        'compton'           # Compositor for X
        'dunst'             # Notification daemon
        'feh'               # Wallpaper management
        'i3lock'            # Screen locker
        'redshift'          # Screen dimmer
        'rofi'              # Application launcher
        'scrot'             # Screenshot utility
        'sxhkd'             # Simple X HotKey Daemon
        'sway'              # i3 replacement for wayland
        'wireless_tools'    # Wireless info parse
        'wmname'            # Window manager name changer
        )
    install -Dm 0755 bbaserdem-desktop.fancylock "${pkgdir}/usr/local/bin/fancy-lock"

    # Libraries for apps to work
    depends+=(
        'mpv'
        'pdfjs'
        'polkit'
        'polkit-gnome'
        'nemo-python'
        'qt4'
        'syncthing'
        'trash-cli'
        'tumbler'
        'udiskie'
        'xsel')

    # Applications
    depends+=(
        'audacity'
        'blender'
        'cantata'
        'cdparanoia'
        'deluge'
        'freerdp'
        'gimp'
        'gourmet'
        'gparted'
        'inkscape'
        'kitty'
        'libreoffice-fresh'
        'nemo'
        'pdfsam'
        'projectm-pulseaudio'
        'picard'
        'smplayer'
        'qutebrowser'
        'qopenvpn'
        'rdesktop'
        'stellarium'
        'syncthing-gtk'
        'termite'
        'udisks2'
        'virt-manager'
        'zathura-pdf-poppler')

    # Graphical theming
    depends+=(
        'arc-gtk-theme'
        'elementary-icon-theme'
        'gnome-themes-extra'
        'gtk-engine-murrine'
        'gtk2fontsel'
        'gucharmap'
        'papirus-icon-theme'
        'qt5-styleplugins')

    # Fonts
    depends+=(
        'tamsyn-font'
        'otf-fira-code'
        'ttf-gentium'
        'ttf-hack'
        'ttf-liberation'
        'noto-fonts-emoji')
}

package_bbaserdem-devel() {
    depends=('bbaserdem-devel')

    # C developement
    depends+=(
        'clang')

    # Arduino developement
    depends+=(
        'arm'
        'arm-none-eabi-binutils'
        'arm-none-eabi-gcc'
        'arm-none-eabi-newlib'
        'avr-binutils'
        'avr-gcc'
        'avr-libc'
        'avrdude'
        'dfu-util')

    # Android developement
    depends+=(
        'android-tools'
        'libmtp')

    # Python developement
    depends+=(
        'bpython'
        'jupyter-nbconvert'
        'jupyter-notebook'
        'lapack'
        'mathjax'
        'openblas'
        'python-matplotlib'
        'python-pip'
        'python-sympy'
        'python-neovim'
        'python-numpy'
        'python-xdg'
        'python2-pip'
        )

    # Java
    depends+=(
        'jre8-openjdk')

    # LaTeX
    depends+=(
        'biber'
        'texlive-core'
        'texlive-fontsextra'
        'texlive-latexextra'
        'texlive-pictures'
        'texlive-pstricks'
        'texlive-science')

    # Virtualization, QEMU
    depends+=(
        'dnsmasq'
        'firewalld'
        'libvirt'
        'qemu'
        'qemu-arch-extra')
}

# Server packages;
#   These packafes should not need xorg, must be settable from console`
package_bbaserdem-server() {
    depends=(bbaserdem-base)

    depends+=(
        'deluge'
        'openvpn'
        'python2-service-identity'
        'syncthing'
        'tlp'
        'youtube-dl')
}

# Computer specific stuff
package_bbaserdem-laptop() {
    depends=(bbaserdem-base bbaserdem-efi bbaserdem-devel bbaserdem-desktop)
    depends+=(
        'blueberry'
        'bluez'
        'bluez-libs'
        'bluez-utils'
        'pulseaudio-bluetooth'
        'mesa'
        'mesa-demos'
        'lib32-mesa'
        'libva-mesa-driver'
        'lib32-libva-mesa-driver'
        'lib32-mesa-demos'
        'mesa-vdpau'
        'libva-vdpau-driver'
        'lib32-mesa-vdpau'
        'libva-vdpau-driver'
        'libva-mesa-driver'
        'xf86-video-amdgpu'
        'vulcan-radeon'
        'tlp')
    install -Dm 0644 bbaserdem-base.bt-sink "${pkgdir}/etc/bluetooth/audio.conf"
    # Steam
    depends+=(
        'steam'
        'steam-native-runtime')
}

package_bbaserdem-workstation() {
    depends=(bbaserdem-base bbaserdem-bios bbaserdem-devel bbaserdem-desktop)

    depends+=(
        'nvidia-340xx-lts'
        'lib32-nvidia-340xx-utils'
        'linux-lts'
        'linux-lts-headers'
        'lm_sensors')
}
